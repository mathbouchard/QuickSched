(function(a){a.fn.extend({ganttScreen:function(c){var d={data:null,mult:2,params:{timestep:15},currw:800,hoff:0,moff:50,itemname:"item",onclick:function(){alert("click")}};var b=a.extend(d,c);return this.each(function(){var k=a(this);k.empty();b.currw=b.currw-180;if(b.data!=null){var f=b.currw;var n=0;var m=0;a.each(b.data,function(q,r){if(ganttval(r.starttimel,b.currw,b.mult)<f){f=ganttval(r.starttimel,b.currw,b.mult)}if(ganttval(r.starttimel,b.currw,b.mult)+ganttvald(r.starttimel,r.starttimeu,r.durationu,b.currw,b.mult)>n){n=ganttval(r.starttimel,b.currw,b.mult)+ganttvald(r.starttimel,r.starttimeu,r.durationu,b.currw,b.mult)}m++});f=0;maxwidth=b.currw;if((n-f)+20>maxwidth){maxwidth=(n-f)+20}var l=a(window).height()-b.hoff-b.moff;var g=a(window).height()-b.hoff-b.moff;if(180+m*50>l){l=180+m*50}var o=ganttval("1:00",b.currw,b.mult);a("<div></div>").addClass("gantthead").css("top",b.moff+20).css("width",maxwidth).css("left",140).appendTo(k);for(i=0;i*o+20<maxwidth;i+=2){a("<div></div>").text(i%24+":00").addClass("gantttime").css("width",o).css("left",140+(i-0.5)*o).css("top",b.moff+20).appendTo(k);a("<div></div>").text((i+1)%24+":00").addClass("gantttime").css("width",o).css("left",140+(i+0.5)*o).css("top",b.moff+35).appendTo(k)}var e=a("<div></div>").addClass("ganttinside").css("overflow-y","scroll").css("top",51).css("width",160+maxwidth).css("left",0).css("height",g-117).css("position","absolute").appendTo(k);for(i=0;(i-i%2)*o+20<maxwidth;i++){if(i%24==0){a("<div></div>").addClass("ganttback").css("width",o).css("border-color","#999").css("left",140+i*o).css("top",b.moff+0).css("height",l-117).appendTo(e)}else{a("<div></div>").addClass("ganttback").css("width",o).css("left",140+i*o).css("top",b.moff+0).css("height",l-117).appendTo(e)}}var j=a('<ul class="ganttlist '+b.itemname+'list" id="curr'+b.itemname+'list"></ul>').selectable({filter:"li",cancel:".ui-selected, .ganttblockadd"}).appendTo(e);var p=a("<li></li>").text("Add new "+b.itemname+".").css("width",b.currw+110).addClass("ganttblock").addClass("ganttblockadd").css("top",b.moff).attr("objid",-1).appendTo(j);p.click(function(){b.onclick("New "+b.itemname,-1)});var h=0;a.each(b.data,function(q,s){var r=a("<li></li>").css("width",maxwidth+110).addClass("ganttblock").attr("objid",s.id).css("top",50+h*50+b.moff).appendTo(j);r.dblclick(function(){b.onclick(s.name,q)});a("<div></div>").text(s.name).addClass("leftganttblock").attr("objid",s.id).appendTo(r);a("<div></div>").css("width",ganttvald(s.starttimel,s.starttimeu,s.durationu,b.currw,b.mult)).css("left",110+ganttval(s.starttimel,b.currw,b.mult)).addClass("rigthganttblock").css("background",s.color).attr("objid",s.id).appendTo(r);h++})}})}})})(jQuery);function ganttval(a,b,c){var d=a.split(":");return(parseFloat(d[0])+parseFloat(d[1])/60)/(24*c)*b}function ganttvald(e,a,c,b,d){return ganttval(a,b,d)-ganttval(e,b,d)+ganttval(c,b,d)};