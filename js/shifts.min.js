(function(a){a.fn.extend({shiftsScreen:function(c){var d={loff:0,toff:0};var b=a.extend(d,c);return this.each(function(){a(this).empty();mobj=a(this);var f=a('<div id="shiftbar"></div>').appendTo(a(this));f.css("width",a(window).width()-b.loff-20);a('<span id="shiftradioassign"></span>').html('<input type="radio" id="shiftradioedit" checked="checked" name="shiftradioassign"/><label for="shiftradioedit">Edit</label><input type="radio" id="shiftradiotag" name="shiftradioassign"/><label for="shiftradiotag">Tags</label><input type="radio" id="shiftradioworker" name="shiftradioassign"/><label for="shiftradioworker">Workers</label>').css("float","left").buttonset().appendTo(f);a("#shiftradioedit").button().click(function(){a("#currvmap").remove();a("#shiftgantt").show();a("#shiftslider").show();a("#shifttrash").show();a("#shiftsliderlabel").show()});a("#shiftradiotag").button().click(function(){a("#currvmap").remove();a("#shiftgantt").hide();a("#shiftslider").hide();a("#shiftsliderlabel").hide();a("#shifttrash").hide();var g=a('<div id="currvmap"></div>').appendTo(mobj);g.vMap({type:6,pos:1,loff:b.loff,toff:b.toff+67,upobj:a.qsglobal.shifts,upblockclass:"tblock",uptextclass:"tblocktext",downobj:a.qsglobal.tags,downblockclass:"tblock",downtextclass:"tblocktext",})});a("#shiftradioworker").button().click(function(){a("#currvmap").remove();a("#shiftgantt").hide();a("#shiftslider").hide();a("#shiftsliderlabel").hide();a("#shifttrash").hide();var g=a('<div id="currvmap"></div>').appendTo(mobj);g.vMap({type:1,pos:2,loff:b.loff,toff:b.toff+67,upobj:a.qsglobal.shifts,upblockclass:"tblock",uptextclass:"tblocktext",downname:function(h){return h.firstname+" "+h.lastname},downdesc:function(h){return h.code},downobj:a.qsglobal.workers,downimg:true,downblockclass:"wblock",downtextclass:"wblocktext",})});a('<label id="shiftsliderlabel" for="shiftslider">Zoom:</label>').css("margin-left",20).css("margin-top",8).css("float","left").appendTo(f);a('<div id="shiftslider"></div>').css("margin-left",10).css("margin-top",10).css("width",100).css("float","left").slider({min:0.2,max:3,step:0.025,value:1.6,slide:function(g,h){a("#shiftgantt").ganttScreen({data:a.qsglobal.shifts,mult:3.2-h.value,itemname:"shift",currw:a(window).width()-b.loff,hoff:b.toff,moff:0,})}}).appendTo(f);a('<span><button id="shiftfullscreen">Fullscreen</button></span>').css("float","right").appendTo(f).css("height","32").css("background","#a0b4d2").button({text:false,icons:{primary:"ui-icon-arrowthick-2-ne-sw"}}).click(function(){if(!a.qsglobal.isfullscreen){a.qsglobal.isfullscreen=true;a("#shifts").empty();a("#appmain").hide();a("#fullscreen").show();a("#fullscreen").width(a(window).width());a("#fullscreen").height(a(window).height());a("#fullscreen").shiftsScreen({loff:0,toff:0})}else{a.qsglobal.isfullscreen=false;a("#fullscreen").empty();a("#fullscreen").hide();a("#appmain").show();a("#shifts").shiftsScreen({loff:83,toff:101})}});a('<span id="shifttrash"><button>Delete</button></span>').css("float","right").appendTo(f).css("height","32").css("background","#a0b4d2").button({text:false,icons:{primary:"ui-icon-trash"}}).click(function(){rem=[];a(".ui-selected",".shiftlist").each(function(){var i=a("#currshiftlist li").index(this)-1;rem.push(i);var h=0;a.each(rem,function(j,k){if(k<i){h++}});i=i-h;var g={token:a.qsglobal.session_token,id:a(this).attr("objid")};postjson(a.qsglobal.dbaddr+"delshifts",g,function(j){if(j.success=="true"){a.qsglobal.shifts.splice(i,1)}else{alert("Delete failed.")}},false,null)});if(!a.qsglobal.isfullscreen){a("#shifts").shiftsScreen({loff:83,toff:101})}else{a("#fullscreen").shiftsScreen()}});var e=a('<div id="shiftgantt"></div>').appendTo(a(this));e.addClass("ganttcontainer").css("width",a(window).width()-b.loff).css("height",a(window).height()-b.toff-1-65);e.css("overflow","scroll");e.ganttScreen({data:a.qsglobal.shifts,mult:1.6,itemname:"shift",currw:a(window).width()-b.loff,hoff:b.toff,moff:0,onclick:function(g,h){a("#shift-form").shiftEditScreen({ind:h,item:a.qsglobal.shifts[h]}).dialog("open").dialog("option","title",g).dialog("open")}})})},shiftEditScreen:function(c){a(this).empty();var d={ind:-1,item:null};var b=a.extend(d,c);return this.each(function(){var P=b;var h=a(this);var w="",j="",G="#cc3333",e="",s="",l="",p="",k="",A="0";inmonday="0";intuesday="0";inwednesday="0";inthursday="0";infriday="0";insaturday="0";inactive="0";if(P.ind!=-1){w=(P.item.name==null)?"":P.item.name;j=(P.item.description==null)?"":P.item.description;G=(P.item.color==null)?"":P.item.color;e=(P.item.location==null)?"":P.item.location;s=(P.item.starttimel==null)?"":P.item.starttimel;l=(P.item.starttimeu==null)?"":P.item.starttimeu;p=(P.item.durationl==null)?"":P.item.durationl;k=(P.item.durationu==null)?"":P.item.durationu;A=(P.item.sunday==null)?"":P.item.sunday;inmonday=(P.item.monday==null)?"":P.item.monday;intuesday=(P.item.tuesday==null)?"":P.item.tuesday;inwednesday=(P.item.wednesday==null)?"":P.item.wednesday;inthursday=(P.item.thursday==null)?"":P.item.thursday;infriday=(P.item.friday==null)?"":P.item.friday;insaturday=(P.item.saturday==null)?"":P.item.saturday;inactive=(P.item.active==null)?"":P.item.active}a(this).css("padding",0).css("margin",0);var N=a('<div id="shift-edit"><div>').appendTo(h);var D=a('<div id="we-top"></div>').css("width","100%").css("height","45px").css("padding",0).css("margin",0).css("float","left").appendTo(N);D.append(a('<p class="validateTips">Fill the required fields</p>').css("margin",10));var n=a('<div id="we-left"></div>').css("width","48%").css("height","100%").css("padding","0 10px 0 10px").css("margin",0).css("float","left").css("border","solid").css("border-color","#aaa").css("border-width","0px 0px 0px 0px").appendTo(N);var M=a('<div id="we-right"></div>').css("width","48%").css("float","left").css("height","100%").appendTo(N);var i=a('<div id="we-bottom"></div>').css("width","100%").css("padding",0).css("margin",0).css("float","left").css("border","solid").css("border-color","#aaa").css("border-width","0px 0px 0px 0px").appendTo(N);var x=a("<div></div>").addClass("breakdiv").appendTo(i);var f=a('<div id="breakbar"></div>').appendTo(x).css("padding","5px 0px 0 0px");f.css("width","100%").css("height","32px");a("<div></div>").html("Breaks").css("padding","5px 0 0 10px").css("margin-right","20px").css("float","left").appendTo(f);a('<span><button id="breakadd"></button></span>').css("float","left").appendTo(f).css("height","32").css("background","#a0b4d2").button({text:false,icons:{primary:"ui-icon-plusthick"}}).click(function(){a("#break-form").breakEditScreen({sind:P.ind,sitem:P.item}).dialog("open")});var q=[];a('<span><button id="breaktrash"></button></span>').css("float","left").appendTo(f).css("height","32").css("background","#a0b4d2").button({text:false,icons:{primary:"ui-icon-trash"}}).click(function(){rem=[];a(".ui-selected",".breaklist").each(function(){var T=a("#currbreaklist li").index(this);rem.push(T);var S=0;a.each(rem,function(U,V){if(V<T){S++}});T=T-S;var o={token:a.qsglobal.session_token,id:a(this).attr("breakid")};postjson(a.qsglobal.dbaddr+"delbreaks",o,function(U){if(U.success=="true"){a.qsglobal.breaks.splice(q[T],1)}else{alert("Delete failed.")}},false,null)});h.shiftEditScreen({ind:b.ind,item:b.item})});var z=a('<ul class="breaklist" id="currbreaklist"></ul>').css("height","98%").css("overflow-y","scroll").appendTo(x);z.selectable({filter:"li",cancel:".ui-selected"});var v=0;if(a.qsglobal.breaks!=null&&b.item!=null){a.each(a.qsglobal.breaks,function(o,S){if(S.shiftid==b.item.id){temp=a("<li></li>").html('<div class="qstabletag">Name</div><div class="qstableval">'+S.name+'</div><div class="qstabletag">Start time</div><div class="qstableval">'+S.starttimel+" (max: "+S.starttimeu+')</div><div class="qstabletag">Duration</div><div class="qstableval">'+S.duration+"</div>").addClass("qstableline").attr("breakid",S.id).dblclick(function(){a("#break-form").breakEditScreen({ind:o,item:S,sind:P.ind,sitem:P.item}).dialog("open")});z.append(temp);q.push(v)}v++})}if(b.item==null){i.hide()}n.append(a("<form></form>").html((P.ind!=-1&&P.item.active=="0"?'<div id="shiftactivechoice"><input type="checkbox" id="shiftactive" value="0" /><label for="shiftactive">Active</label></div>':'<div id="shiftactivechoice"><input type="checkbox" id="shiftactive" value="1" checked="checked"/><label for="shiftactive">Active</label></div>')+'<fieldset><label style="display: inline-block; width: 40%; height: 25px;" for="shiftname">Task</label><input type="text" id="shiftname" value="'+w+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%"/><br/><label style="display: inline-block; width: 40%; height: 25px;" for="shiftdescription">Description</label><input type="text" id="shiftdescription" value="'+j+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%"/><br/><label style="display: inline-block; width: 40%; height: 25px;" for="shiftcolor">Color</label><input style="display: inline-block;" id="shiftcolor" value="'+G+'"><br/><label style="display: inline-block; width: 40%; height: 25px;" for="shiftlocation">Location</label><input type="button" id="shiftlocation" value="'+e+'" class="button ui-widget-content ui-corner-all" style="display: inline-block; width:55%"/><br /></fieldset>'));M.append(a("<form></form>").html('<fieldset><label style="display: inline-block; width: 40%; height: 25px;" for="shiftstarttimel">Start time (min)</label><input type="text" id="shiftstarttimel" value="'+s+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%;"/><br /><label style="display: inline-block; width: 40%; height: 25px;" for="shiftstarttimeu">Start time (max)</label><input type="text" id="shiftstarttimeu" value="'+l+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%;"/><br /><label style="display: inline-block; width: 40%; height: 25px;" for="shiftdurationl">Duration (min)</label><input type="text" id="shiftdurationl" value="'+p+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%;"/><br /><label style="display: inline-block; width: 40%; height: 25px;" for="shiftdurationu">Duration (max)</label><input type="text" id="shiftdurationu" value="'+k+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%;"/><br /></fieldset><div style="display: inline-block; width: 40%; height: 25px;">Recurrence</div><div id="shiftweekday" style="float: right;;padding: 0 0 10px 0;">'+(P.ind!=-1&&P.item.sunday=="1"?'<input type="checkbox" style="display: inline-block;" id="shiftsunday" value="1" checked="checked"/><label for="shiftsunday">Su</label>':'<input type="checkbox" style="display: inline-block;" id="shiftsunday" value="0"/><label for="shiftsunday">Su</label>')+(P.ind!=-1&&P.item.monday=="1"?'<input type="checkbox" style="display: inline-block;" id="shiftmonday" value="1" checked="checked"/><label for="shiftmonday">Mo</label>':'<input type="checkbox" style="display: inline-block;" id="shiftmonday" value="0"/><label for="shiftmonday">Mo</label>')+(P.ind!=-1&&P.item.tuesday=="1"?'<input type="checkbox" style="display: inline-block;" id="shifttuesday" value="1" checked="checked"/><label for="shifttuesday">Tu</label>':'<input type="checkbox" style="display: inline-block;" id="shifttuesday" value="0"/><label for="shifttuesday">Tu</label>')+(P.ind!=-1&&P.item.wednesday=="1"?'<input type="checkbox" style="display: inline-block;" id="shiftwednesday" value="1" checked="checked"/><label for="shiftwednesday">We</label>':'<input type="checkbox" style="display: inline-block;" id="shiftwednesday" value="0"/><label for="shiftwednesday">We</label>')+(P.ind!=-1&&P.item.thursday=="1"?'<input type="checkbox" style="display: inline-block;" id="shiftthursday" value="1" checked="checked"/><label for="shiftthursday">Th</label>':'<input type="checkbox" style="display: inline-block;" id="shiftthursday" value="0"/><label for="shiftthursday">Th</label>')+(P.ind!=-1&&P.item.friday=="1"?'<input type="checkbox" style="display: inline-block;" id="shiftfriday" value="1" checked="checked"/><label for="shiftfriday">Fr</label>':'<input type="checkbox" style="display: inline-block;" id="shiftfriday" value="0"/><label for="shiftfriday">Fr</label>')+(P.ind!=-1&&P.item.saturday=="1"?'<input type="checkbox" style="display: inline-block;" id="shiftsaturday" value="1" checked="checked"/><label for="shiftsaturday">Sa</label>':'<input type="checkbox" style="display: inline-block;" id="shiftsaturday" value="0"/><label for="shiftsaturday">Sa</label>')+"</div>"));if(a("#shiftlocation").val()==""){a("#shiftlocation").button().click(function(){a.qsglobal.currcoord=a(this);setmap("0,0",a("#shiftlocation"),true)})}else{a("#shiftlocation").button().click(function(){a.qsglobal.currcoord=a(this);setmap(a("#shiftlocation").val(),a("#shiftlocation"),false)})}a("#shiftactivechoice").buttonset();a("#shiftweekday").buttonset();a("#shiftcolor").simpleColor({border:"1px solid #333333",boxHeight:"25px",displayColorCode:true});a("#shiftactive").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#shiftsunday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#shiftmonday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#shifttuesday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#shiftwednesday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#shiftthursday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#shiftfriday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#shiftsaturday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});var r=a("#shiftname"),t=a("#shiftdescription"),F=a("#shiftcolor"),u=a("#shiftlocation"),K=a("#shiftstarttimel"),I=a("#shiftstarttimeu"),H=a("#shiftdurationl"),B=a("#shiftdurationu"),R=a("#shiftsunday"),C=a("#shiftmonday"),O=a("#shifttuesday"),J=a("#shiftwednesday"),m=a("#shiftthursday"),g=a("#shiftfriday"),y=a("#shiftsaturday"),Q=a("#shiftactive"),E=a([]).add(r).add(t).add(F).add(u).add(K).add(I).add(H).add(B).add(R).add(C).add(O).add(J).add(m).add(g).add(y).add(Q),L=a(".validateTips");h.dialog({autoOpen:false,width:950,modal:true,buttons:{Save:function(){var S=true;E.removeClass("ui-state-error");var o={token:a.qsglobal.session_token,name:r.val(),description:t.val(),color:F.val(),location:u.val(),starttimel:K.val(),starttimeu:I.val(),durationl:H.val(),durationu:B.val(),sunday:R.val(),monday:C.val(),tuesday:O.val(),wednesday:J.val(),thursday:m.val(),friday:g.val(),saturday:y.val(),active:Q.val(),id:-1};if(P.ind==-1){o.id=-1;postjson(a.qsglobal.dbaddr+"addshifts",o,function(T){if(T.success=="true"){o.id=T.id;a.qsglobal.shifts.push(o);if(!a.qsglobal.isfullscreen){a("#shifts").shiftsScreen({loff:83,toff:101})}else{a("#fullscreen").shiftsScreen()}}else{alert("Save failed.")}},false,null)}else{o.id=P.item.id;postjson(a.qsglobal.dbaddr+"updateshifts",o,function(T){if(T.success=="true"){o.id=P.item.id;a.qsglobal.shifts.splice(P.ind,1,o);if(!a.qsglobal.isfullscreen){a("#shifts").shiftsScreen({loff:83,toff:101})}else{a("#fullscreen").shiftsScreen()}}else{alert("Save failed.")}},false,null)}a(this).dialog("close")},Cancel:function(){a(this).dialog("close")}},close:function(){E.val("").removeClass("ui-state-error")}})})},breakEditScreen:function(c){a(this).empty();var d={ind:-1,sind:-1,item:null,sitem:null};var b=a.extend(d,c);return this.each(function(){var f=b;var i=a(this);var n="",t="",m="",q="";inminfromextremities="";inminfrombreaks="";if(f.ind!=-1){n=f.item.name;t=f.item.starttimel;m=f.item.starttimeu;q=f.item.duration;inminfromextremities=f.item.minfromextremities;inminfrombreaks=f.item.minfrombreaks}var s=a('<div id="break-edit"><div>').appendTo(i);s.append(a('<p class="validateTips">Fill the required fields</p>'));s.append(a("<form></form>").html('<fieldset><label style="display: inline-block; width: 15%; height: 25px;" for="breakname">Name</label><input type="text" id="breakname" value="'+n+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:80%"/><br/><label style="display: inline-block; width: 15%; height: 25px;" for="breakstarttimel">Start time (min)</label><input type="text" id="breakstarttimel" value="'+t+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:80%"/><br/><label style="display: inline-block; width: 15%; height: 25px;" for="breakstarttimeu">Start time (max)</label><input type="text" id="breakstarttimeu" value="'+m+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:80%"/><br/><label style="display: inline-block; width: 15%; height: 25px;" for="breakduration">Duration</label><input type="text" id="breakduration" value="'+q+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:80%"/><br/><label style="display: inline-block; width: 15%; height: 25px;" for="breakminfromextremities">Gap from extremities</label><input type="text" id="breakminfromextremities" value="'+inminfromextremities+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:80%"/><br/><label style="display: inline-block; width: 15%; height: 25px;" for="breakminfrombreaks">Gap between breaks</label><input type="text" id="breakminfrombreaks" value="'+inminfrombreaks+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:80%"/><br/></fieldset>'));var e=a("#breakname"),r=a("#breakstarttimel"),k=a("#breakstarttimeu"),h=a("#breakduration"),g=a("#breakminfromextremities"),j=a("#breakminfromextremities"),p=a([]).add(e).add(r).add(k).add(h).add(g).add(j),l=a(".validateTips");i.dialog({autoOpen:false,width:750,modal:true,buttons:{Save:function(){var o=true;p.removeClass("ui-state-error");var u={token:a.qsglobal.session_token,name:e.val(),starttimel:r.val(),starttimeu:k.val(),duration:h.val(),minfromextremities:g.val(),minfrombreaks:j.val(),shiftid:f.sitem.id,id:""};if(f.ind==-1){u.id=-1;postjson(a.qsglobal.dbaddr+"addbreaks",u,function(v){if(v.success=="true"){u.id=v.id;a.qsglobal.breaks.push(u);a("#shift-form").shiftEditScreen({ind:f.sind,item:f.sitem})}else{alert("Save failed.")}},false,null)}else{u.id=f.item.id;postjson(a.qsglobal.dbaddr+"updatebreaks",u,function(v){if(v.success=="true"){u.id=f.item.id;a.qsglobal.breaks.splice(f.ind,1,u);a("#shift-form").shiftEditScreen({ind:f.sind,item:f.sitem})}else{alert("Save failed.")}},false,null)}a(this).dialog("close")},Cancel:function(){a(this).dialog("close")}},close:function(){p.val("").removeClass("ui-state-error")}})})}})})(jQuery);function getshiftsdata(a){$.qsglobal.shifts=null;var b={token:$.qsglobal.session_token};postjson($.qsglobal.dbaddr+"getshifts",b,function(d){if(d!=null){$.qsglobal.shifts=d.slice()}},true,a);var c={token:$.qsglobal.session_token};postjson($.qsglobal.dbaddr+"getbreaks",c,function(d){if(d!=null){$.qsglobal.breaks=d.slice()}},true,a)};