(function(a){a.fn.extend({tagsScreen:function(c){var d={loff:0,toff:0};var b=a.extend(d,c);return this.each(function(){var f=a(this);a(this).empty();var g=a('<div id="tagbar"></div>').appendTo(a(this));g.css("width",a(window).width()-b.loff-20);a('<span id="tagradioassign"></span>').html('<input type="radio" id="tagradioedit" checked="checked" name="tagradioassign"/><label for="tagradioedit">Edit</label><input type="radio" id="tagradioworker" name="tagradioassign"/><label for="tagradioworker">Workers</label><input type="radio" id="tagradiotask" name="tagradioassign"/><label for="tagradiotask">Tasks</label><input type="radio" id="tagradioshift" name="tagradioassign"/><label for="tagradioshift">Shifts</label><input type="radio" id="tagradioresource" name="tagradioassign"/><label for="tagradioresource">Resources</label>').css("float","left").buttonset().appendTo(g);a("#tagradioedit").button().click(function(){a("#currvmap").remove();a("#currtaglist").show()});a("#tagradioworker").button().click(function(){a("#currvmap").remove();a("#currtaglist").hide();var h=a('<div id="currvmap"></div>').appendTo(f);h.vMap({type:3,pos:2,loff:b.loff,toff:b.toff+67,upobj:a.qsglobal.tags,upblockclass:"tblock",uptextclass:"tblocktext",downname:function(i){return i.firstname+" "+i.lastname},downdesc:function(i){return i.code},downimg:true,downobj:a.qsglobal.workers,downblockclass:"wblock",downtextclass:"wblocktext",})});a("#tagradiotask").button().click(function(){a("#currvmap").remove();a("#currtaglist").hide();var h=a('<div id="currvmap"></div>').appendTo(f);h.vMap({type:5,pos:2,loff:b.loff,toff:b.toff+67,upobj:a.qsglobal.tags,upblockclass:"tblock",uptextclass:"tblocktext",downobj:a.qsglobal.tasks,downblockclass:"tblock",downtextclass:"tblocktext",})});a("#tagradioshift").button().click(function(){a("#currvmap").remove();a("#currtaglist").hide();var h=a('<div id="currvmap"></div>').appendTo(f);h.vMap({type:6,pos:2,loff:b.loff,toff:b.toff+67,upobj:a.qsglobal.tags,upblockclass:"tblock",uptextclass:"tblocktext",downobj:a.qsglobal.shifts,downblockclass:"tblock",downtextclass:"tblocktext",})});a("#tagradioresource").button().click(function(){a("#currvmap").remove();a("#currtaglist").hide();var h=a('<div id="currvmap"></div>').appendTo(f);h.vMap({type:7,pos:2,loff:b.loff,toff:b.toff+67,upobj:a.qsglobal.tags,upblockclass:"tblock",uptextclass:"tblocktext",downdesc:function(i){return i.description+" ("+i.capacity+")"},downobj:a.qsglobal.resources,downblockclass:"rblock",downtextclass:"rblocktext",})});a('<span><button id="tagfullscreen">Fullscreen</button></span>').css("float","right").appendTo(g).css("height","32").css("background","#a0b4d2").button({text:false,icons:{primary:"ui-icon-arrowthick-2-ne-sw"}}).click(function(){if(!a.qsglobal.isfullscreen){a.qsglobal.isfullscreen=true;a("#tags").empty();a("#appmain").hide();a("#fullscreen").show();a("#fullscreen").width(a(window).width());a("#fullscreen").height(a(window).height());a("#fullscreen").tagsScreen({loff:0,toff:0})}else{a.qsglobal.isfullscreen=false;a("#fullscreen").empty();a("#fullscreen").hide();a("#appmain").show();a("#tags").tagsScreen({loff:83,toff:101})}});a('<span><button id="tagtrash">Delete</button></span>').css("float","right").appendTo(g).css("height","32").css("background","#a0b4d2").button({text:false,icons:{primary:"ui-icon-trash"}}).click(function(){rem=[];a(".ui-selected",".taglist").each(function(){var j=a("#currtaglist li").index(this)-1;rem.push(j);var i=0;a.each(rem,function(k,l){if(l<j){i++}});j=j-i;var h={token:a.qsglobal.session_token,id:a(this).attr("tagid")};postjson(a.qsglobal.dbaddr+"deltags",h,function(k){if(k.success=="true"){a.qsglobal.tags.splice(j,1)}else{alert("Delete failed.")}},false,null)});if(!a.qsglobal.isfullscreen){a("#tags").tagsScreen({loff:83,toff:101})}else{a("#fullscreen").tagsScreen()}});var e=a('<ul class="taglist" id="currtaglist"></ul>').appendTo(a(this));if(a.qsglobal.tags!=null){temp=a("<li></li>").html('<img src="img/plus.png"></img><div class="tblocktext">Add a new tag</div>').addClass("tblock").click(function(){a("#tag-form").tagEditScreen().dialog("open")}).addClass("taddblock").attr("tagid",-1);e.append(temp);a.each(a.qsglobal.tags,function(h,i){temp=a("<li></li>").html('<div class="tcolorblock" style="background:'+i.color+'"></div><div class="tblocktext"><h3>'+i.name+"</h3>"+i.description+"</div>").addClass("tblock").attr("tagid",i.id).dblclick(function(){a("#tag-form").tagEditScreen({ind:h,item:i}).dialog("open")});e.append(temp)})}e.selectable({filter:"li",cancel:".ui-selected, .taddblock"})})},tagEditScreen:function(c){a(this).empty();var d={ind:-1,item:null};var b=a.extend(d,c);return this.each(function(){var f=b;var i=a(this);var l="",g="",p="#cc3333";if(f.ind!=-1){l=f.item.name;g=f.item.description;p=f.item.color}var n=a('<div id="tag-edit"><div>').appendTo(i);n.append(a('<p class="validateTips">Fill the required fields</p>'));n.append(a("<form></form>").html('<fieldset><label style="display: inline-block; width: 15%; height: 25px;" for="tagcolor">Color</label><input style="display: inline-block;" id="tagcolor" value="'+p+'"><br/><label style="display: inline-block; width: 15%; height: 25px;" for="tagname">Tag</label><input type="text" id="tagname" value="'+l+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:80%"/><br/><label style="display: inline-block; width: 15%; height: 25px;" for="tagdesc">Description</label><input type="text" id="tagdesc" value="'+g+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:80%;"/><br /></fieldset>'));a("#tagcolor").simpleColor({border:"1px solid #333333",boxHeight:"25px",displayColorCode:true});var e=a("#tagname"),j=a("#tagdesc"),h=a("#tagcolor"),m=a([]).add(e).add(j).add(h),k=a(".validateTips");i.dialog({autoOpen:false,width:750,modal:true,buttons:{Save:function(){var q=true;m.removeClass("ui-state-error");var o={token:a.qsglobal.session_token,name:"",description:"",color:"",id:""};o.name=e.val();o.description=j.val();o.color=h.val();if(f.ind==-1){o.id=-1;postjson(a.qsglobal.dbaddr+"addtags",o,function(r){if(r.success=="true"){o.id=r.id;a.qsglobal.tags.push(o);if(!a.qsglobal.isfullscreen){a("#tags").tagsScreen({loff:83,toff:101})}else{a("#fullscreen").tagsScreen()}}else{alert("Save failed.")}},false,null)}else{o.id=f.item.id;postjson(a.qsglobal.dbaddr+"updatetags",o,function(r){if(r.success=="true"){o.id=f.item.id;a.qsglobal.tags.splice(f.ind,1,o);if(!a.qsglobal.isfullscreen){a("#tags").tagsScreen({loff:83,toff:101})}else{a("#fullscreen").tagsScreen()}}else{alert("Save failed.")}},false,null)}a(this).dialog("close")},Cancel:function(){a(this).dialog("close")}},close:function(){m.val("").removeClass("ui-state-error")}})})}})})(jQuery);function gettagsdata(b){$.qsglobal.tags=null;var a={token:$.qsglobal.session_token};postjson($.qsglobal.dbaddr+"gettags",a,function(c){if(c!=null){$.qsglobal.tags=c.slice()}},true,b)};