(function(a){a.fn.extend({resourcesScreen:function(c){var d={loff:0,toff:0};var b=a.extend(d,c);return this.each(function(){a(this).empty();obj=a(this);var f=a('<div id="resbar"></div>').appendTo(a(this));f.css("width",a(window).width()-b.loff-20);a('<span id="resradioassign"></span>').html('<input type="radio" id="resradioedit" checked="checked" name="resradioassign"/><label for="resradioedit">Edit</label><input type="radio" id="resradiotag" name="resradioassign"/><label for="resradiotag">Tags</label><input type="radio" id="resradioworker" name="resradioassign"/><label for="resradioworker">Workers</label><input type="radio" id="resradiotask" name="resradioassign"/><label for="resradiotask">Tasks</label>').css("float","left").buttonset().appendTo(f);a("#resradioedit").button().click(function(){a("#currvmap").remove();a("#currreslist").show()});a("#resradiotag").button().click(function(){a("#currvmap").remove();a("#currreslist").hide();var g=a('<div id="currvmap"></div>').appendTo(obj);g.vMap({type:7,pos:1,loff:b.loff,toff:b.toff+67,updesc:function(h){return h.desc+" ("+h.capacity+")"},upobj:a.qsglobal.resources,upblockclass:"rblock",uptextclass:"rblocktext",downobj:a.qsglobal.tags,downblockclass:"tblock",downtextclass:"tblocktext",})});a("#resradioworker").button().click(function(){a("#currvmap").remove();a("#currreslist").hide();var g=a('<div id="currvmap"></div>').appendTo(obj);g.vMap({type:2,pos:2,loff:b.loff,toff:b.toff+67,updesc:function(h){return h.desc+" ("+h.capacity+")"},upobj:a.qsglobal.resources,upblockclass:"rblock",uptextclass:"rblocktext",downname:function(h){return h.firstname+" "+h.lastname},downdesc:function(h){return h.code},downobj:a.qsglobal.workers,downimg:true,downblockclass:"wblock",downtextclass:"wblocktext",})});a("#resradiotask").button().click(function(){a("#currvmap").remove();a("#currreslist").hide();var g=a('<div id="currvmap"></div>').appendTo(obj);g.vMap({type:4,pos:2,loff:b.loff,toff:b.toff+67,updesc:function(h){return h.desc+" ("+h.capacity+")"},upobj:a.qsglobal.resources,upblockclass:"rblock",uptextclass:"rblocktext",downobj:a.qsglobal.tasks,downblockclass:"tblock",downtextclass:"tblocktext",})});a('<span><button id="resfullscreen">Fullscreen</button></span>').css("float","right").appendTo(f).css("height","32").css("background","#a0b4d2").button({text:false,icons:{primary:"ui-icon-arrowthick-2-ne-sw"}}).click(function(){if(!a.qsglobal.isfullscreen){a.qsglobal.isfullscreen=true;a("#resources").empty();a("#appmain").hide();a("#fullscreen").show();a("#fullscreen").width(a(window).width());a("#fullscreen").height(a(window).height());a("#fullscreen").resourcesScreen({loff:0,toff:0})}else{a.qsglobal.isfullscreen=false;a("#fullscreen").empty();a("#fullscreen").hide();a("#appmain").show();a("#resources").resourcesScreen({loff:83,toff:101})}});a('<span><button id="restrash">Delete</button></span>').css("float","right").appendTo(f).css("height","32").css("background","#a0b4d2").button({text:false,icons:{primary:"ui-icon-trash"}}).click(function(){rem=[];a(".ui-selected",".reslist").each(function(){var h=a("#currreslist li").index(this)-1;rem.push(h);var g=0;a.each(rem,function(j,k){if(k<h){g++}});h=h-g;var i={token:a.qsglobal.session_token,id:a(this).attr("resourceid")};postjson(a.qsglobal.dbaddr+"delresources",i,function(j){if(j.success=="true"){a.qsglobal.resources.splice(h,1)}else{alert("Delete failed.")}},false,null)});if(!a.qsglobal.isfullscreen){a("#resources").resourcesScreen({loff:83,toff:101})}else{a("#fullscreen").resourcesScreen()}});var e=a('<ul class="reslist" id="currreslist"></ul>').appendTo(a(this));if(a.qsglobal.resources!=null){temp=a("<li></li>").html('<img src="img/plus.png"></img><div class="rblocktext">Add a new tag</div>').addClass("rblock").click(function(){a("#resource-form").resourceEditScreen().dialog("open")}).addClass("raddblock").attr("resourceid",-1);e.append(temp);a.each(a.qsglobal.resources,function(g,h){temp=a("<li></li>").html('<div class="rcolorblock" style="background:'+h.color+'"></div><div class="rblocktext"><h3>'+h.name+"</h3>"+h.description+" ("+h.capacity+")</div>").addClass("rblock").attr("resourceid",h.id).dblclick(function(){a("#resource-form").resourceEditScreen({ind:g,item:h}).dialog("open")});e.append(temp)})}e.selectable({filter:"li",cancel:".ui-selected, .raddblock"})})},resourceEditScreen:function(c){a(this).empty();var d={ind:-1,item:null};var b=a.extend(d,c);return this.each(function(){var g=b;var j=a(this);var m="",h="",r="#cc3333",p="1";if(g.ind!=-1){m=g.item.name;h=g.item.description;r=g.item.color;p=g.item.capacity}var q=a('<div id="resource-edit"><div>').appendTo(j);q.append(a('<p class="validateTips">Fill the required fields</p>'));q.append(a("<form></form>").html('<fieldset><label style="display: inline-block; width: 15%; height: 25px;" for="rescolor">Color</label><input style="display: inline-block;" id="rescolor" value="'+r+'"><br/><label style="display: inline-block; width: 15%; height: 25px;" for="resname">Tag</label><input type="text" id="resname" value="'+m+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:80%"/><br/><label style="display: inline-block; width: 15%; height: 25px;" for="resdesc">Description</label><input type="text" id="resdesc" value="'+h+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:80%;"/><br /><label style="display: inline-block; width: 15%; height: 25px;" for="rescapacity">Capacity</label><input type="text" id="rescapacity" value="'+p+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:80%;"/><br /></fieldset>'));a("#rescolor").simpleColor({border:"1px solid #333333",boxHeight:"25px",displayColorCode:true});var f=a("#resname"),k=a("#resdesc"),i=a("#rescolor"),e=a("#rescapacity"),n=a([]).add(f).add(k).add(i).add(e),l=a(".validateTips");j.dialog({autoOpen:false,width:750,modal:true,buttons:{Save:function(){var o=true;n.removeClass("ui-state-error");var s={token:a.qsglobal.session_token,name:"",description:"",color:"",capacity:"1",id:""};s.name=f.val();s.description=k.val();s.color=i.val();s.capacity=e.val();if(g.ind==-1){s.id=-1;postjson(a.qsglobal.dbaddr+"addresources",s,function(t){if(t.success=="true"){s.id=t.id;a.qsglobal.resources.push(s);if(!a.qsglobal.isfullscreen){a("#resources").resourcesScreen({loff:83,toff:101})}else{a("#fullscreen").resourcesScreen()}}else{alert("Save failed.")}},false,null)}else{s.id=g.item.id;postjson(a.qsglobal.dbaddr+"updateresources",s,function(t){if(t.success=="true"){s.id=g.item.id;a.qsglobal.resources.splice(g.ind,1,s);if(!a.qsglobal.isfullscreen){a("#resources").resourcesScreen({loff:83,toff:101})}else{a("#fullscreen").resourcesScreen()}}else{alert("Save failed.")}},false,null)}a(this).dialog("close")},Cancel:function(){a(this).dialog("close")}},close:function(){n.val("").removeClass("ui-state-error")}})})}})})(jQuery);function getresourcesdata(a){$.qsglobal.resources=null;var b={token:$.qsglobal.session_token};postjson($.qsglobal.dbaddr+"getresources",b,function(c){if(c!=null){$.qsglobal.resources=c.slice()}},true,a)};