(function(a){a.fn.extend({vMap:function(b){var c={loff:0,toff:0,type:7,pos:1,upobj:null,upimg:false,upname:function(e){return e.name},updesc:function(e){return e.description},upblockclass:"wblock",uptextclass:"wblocktext",downobj:null,downimg:false,downname:function(e){return e.name},downdesc:function(e){return e.description},downblockclass:"wblock",downtextclass:"wblocktext",};var d=a.extend(c,b);return this.each(function(){a(this).empty();var i=a(this);var f=a('<div id="vmap-up"></div>').css("overflow-y","scroll").css("width",a(window).width()-d.loff).css("height",(a(window).height()-d.toff)/2).css("border","solid").css("border-color","#aaa").css("border-width","0px 0px 1px 0px").appendTo(a(this));var h=a('<div id="vmap-down"></div>').css("overflow-y","scroll").css("width",a(window).width()-d.loff).css("height",(a(window).height()-d.toff)/2).appendTo(a(this));var g=a('<ul id="uplist"></ul>').appendTo(f);var e=a('<ul id="downlist"></ul>').appendTo(h);if(d.upobj!=null){a.each(d.upobj,function(j,l){var k="";if(d.upimg){var m="img/someone_wb.png";if(l.picturelink!=null&&l.picturelink!=""){m=l.picturelink}k='<img src="'+m+'"></img>'}temp=a("<li></li>").html('<div class="tcolorblock" style="background:'+l.color+'">'+k+'</div><div class="'+d.uptextclass+'"><h3>'+d.upname(l)+"</h3>"+d.updesc(l)+"</div>").addClass(d.upblockclass).dblclick(function(){a('<div id="individualmapping"></div>').appendTo(i).hMap({type:d.type,pos:d.pos,obj:d.downobj,subobj:a.qsglobal.maps,img:d.downimg,id:l.id,blockclass:d.downblockclass,textclass:d.downtextclass,name:d.downname,desc:d.downdesc,}).dialog("option","title",d.upname(l)+" mapping").dialog("open")}).attr("objid",l.id);g.append(temp)})}if(d.downobj!=null){a.each(d.downobj,function(j,l){var k="";if(d.downimg){var m="img/someone_wb.png";if(l.picturelink!=null&&l.picturelink!=""){m=l.picturelink}k='<img src="'+m+'"></img>'}temp=a("<li></li>").html('<div class="tcolorblock" style="background:'+l.color+'">'+k+'</div><div class="'+d.downtextclass+'"><h3>'+d.downname(l)+"</h3>"+d.downdesc(l)+"</div>").addClass(d.downblockclass).attr("objid",l.id);e.append(temp)})}a("#uplist li").draggable({appendTo:"body",helper:"clone"});a("#downlist li").droppable({activeClass:"vmap-active",hoverClass:"vmap-hover",drop:function(k,l){var j={};if(d.pos==1){j={token:a.qsglobal.session_token,id2:a(this).attr("objid"),id1:l.draggable.attr("objid"),type:d.type,qty:1,starttime:"0:00",duration:"0:00"}}else{j={token:a.qsglobal.session_token,id1:a(this).attr("objid"),id2:l.draggable.attr("objid"),type:d.type,qty:1,starttime:"0:00",duration:"0:00"}}postjson(a.qsglobal.dbaddr+"addmaps",j,function(m){if(m.success=="true"){a.qsglobal.maps.push(j)}else{alert("Redundant map.")}},true,null)}})})},hMap:function(b){var c={obj:null,subobj:null,type:7,pos:1,id:-1,img:false,name:function(e){return e.name},desc:function(e){return e.description},blockclass:"wblock",textclass:"wblocktext",};var d=a.extend(c,b);return this.each(function(){a(this).empty();obj=a(this);a(this).css("padding",0).css("margin",0);var k=a('<div id="hmap-left"><h3 style="text-align: center">Mapped</h3></div>').css("width","50%").css("height","100%").css("float","left").css("overflow","scroll").css("border","solid").css("border-color","#aaa").css("border-width","0px 1px 0px 0px").appendTo(obj);var g=a('<div id="hmap-right"><h3 style="text-align: center">Not mapped</h3></div>').css("width","49%").css("float","left").css("height","100%").css("overflow","scroll").appendTo(obj);var e=a('<ul id="llist"></ul>').appendTo(k);var h=a('<ul id="rlist"></ul>').appendTo(g);var m={};var f={};setmapid(d,d.subobj);var l=[];if(d.subobj!=null){a.each(d.subobj,function(n,o){if(d.pos==1){if(o.type==d.type&&o.id1==d.id){l.push(o.id2)}}else{if(o.type==d.type&&o.id2==d.id){l.push(o.id1)}}})}if(d.obj!=null){a.each(d.obj,function(n,o){f[o.id]=n})}a.each(l,function(n,q){m[q]=true;var o=d.obj[f[q]];var p="";if(d.img){var r="img/someone_wb.png";if(o.picturelink!=null){r=o.picturelink}p='<img src="'+r+'"></img>'}temp=a("<li></li>").html('<div class="tcolorblock" style="background:'+o.color+'">'+p+'</div><div class="'+d.textclass+'"><h3>'+d.name(o)+"</h3>"+d.desc(o)+"</div>").addClass(d.blockclass).attr("objid",o.id).addClass("lmapobj");if(d.type==4){temp.dblclick(function(){a("#taskres-form").taskresEditScreen({item:d.subobj[a.qsglobal.mapid[o.id]],ind:a.qsglobal.mapid[o.id]}).dialog("open")})}e.append(temp)});if(d.obj!=null){a.each(d.obj,function(n,p){var o="";if(m[p.id]!=true){if(d.img){var q="img/someone_wb.png";if(p.picturelink!=null&&p.picturelink!=""){q=p.picturelink}o='<img src="'+q+'"></img>'}temp=a("<li></li>").html('<div class="tcolorblock" style="background:'+p.color+'">'+o+'</div><div class="'+d.textclass+'"><h3>'+d.name(p)+"</h3>"+d.desc(p)+"</div>").addClass(d.blockclass).attr("objid",p.id).addClass("rmapobj");h.append(temp)}})}var i=null;var j=null;makedragdrop(d,i,j);obj.dialog({autoOpen:false,height:700,width:950,modal:true,close:function(){}})})}})})(jQuery);function makedragdrop(b,c,a){$("#rlist li").draggable({helper:function(){c=$(this);a=$("<li></li>").html($(this).html()).addClass(b.blockclass).attr("objid",$(this).attr("objid")).addClass("rmapobj");return a},opacity:0.7,});$("#hmap-right").droppable({accept:":not(.rmapobj)",activeClass:"vmap-active",drop:function(f,g){var e=$("<li></li>").html(a.html()).addClass(b.blockclass).attr("objid",a.attr("objid")).addClass("rmapobj");$("#rlist").append(e);c.remove();var d={token:$.qsglobal.session_token,id1:a.attr("objid"),id2:b.id,type:b.type,qty:1};if(b.pos==1){d.id1=b.id;d.id2=a.attr("objid")}postjson($.qsglobal.dbaddr+"delmaps",d,function(h){if(h.success=="true"){b.subobj.splice($.qsglobal.mapid[a.attr("objid")],1);setmapid(b,b.subobj)}else{alert("Delete failed.")}},true,null);makedragdrop(b,c,a)}});$("#llist li").draggable({helper:function(){c=$(this);a=$("<li></li>").html($(this).html()).addClass(b.blockclass).attr("objid",$(this).attr("objid")).addClass("lmapobj");return a},opacity:0.7,});$("#hmap-left").droppable({accept:":not(.lmapobj)",activeClass:"vmap-active",drop:function(f,g){var e=$("<li></li>").html(a.html()).addClass(b.blockclass).attr("objid",a.attr("objid")).addClass("lmapobj");$("#llist").append(e);if(b.type==4){e.dblclick(function(){$("#taskres-form").taskresEditScreen({item:b.subobj[$.qsglobal.mapid[e.attr("objid")]],ind:$.qsglobal.mapid[e.attr("objid")]}).dialog("open")})}c.remove();var d={token:$.qsglobal.session_token,id1:a.attr("objid"),id2:b.id,type:b.type,qty:1};if(b.pos==1){d.id1=b.id;d.id2=a.attr("objid")}postjson($.qsglobal.dbaddr+"addmaps",d,function(h){if(h.success=="true"){b.subobj.push(d);setmapid(b,b.subobj)}else{alert("Delete failed.")}},true,null);makedragdrop(b,c,a)}})}function setmapid(b,a){$.qsglobal.mapid={};if(a!=null){$.each(a,function(c,d){if(d.type==b.type){if(b.pos==1){$.qsglobal.mapid[d.id2]=c}else{$.qsglobal.mapid[d.id1]=c}}})}};