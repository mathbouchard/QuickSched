(function(a){a.fn.extend({tasksScreen:function(c){var d={loff:0,toff:0};var b=a.extend(d,c);return this.each(function(){a(this).empty();var e=a(this);var f={};var g=0;a.each(a.qsglobal.tasks,function(i,k){f[g]={id:-1,name:"",starttimel:"0:00",startimeu:"0:00",durationl:"0:00",durationu:"0:00",color:"#00f"};f[g].starttimel=f[g].starttimeu=k.starttime;f[g].durationl=f[g].durationu=k.duration;f[g].name=k.name;f[g].color=k.color;f[g].id=k.id;g++});var j=a('<div id="taskbar"></div>').appendTo(a(this));j.css("width",a(window).width()-b.loff-20);a('<span id="taskradioshow"></span>').html('<input type="radio" id="taskradiotask" checked="checked" name="taskradioshow"/><label for="taskradiotask">Tasks</label><input type="radio" id="taskradiodemand" name="taskradioshow"/><label for="taskradiodemand">Demands</label>').css("float","left").buttonset().appendTo(j);a('<span id="taskradioassign"></span>').html('<input type="radio" id="taskradioedit" checked="checked" name="taskradioassign"/><label for="taskradioedit">Edit</label><input type="radio" id="taskradiotag" name="taskradioassign"/><label for="taskradiotag">Tags</label><input type="radio" id="taskradioworker" name="taskradioassign"/><label for="taskradioworker">Workers</label><input type="radio" id="taskradioresource" name="taskradioassign"/><label for="taskradioresource">Resources</label>').css("float","left").buttonset().appendTo(j);a("#taskradioedit").button().click(function(){a("#currvmap").remove();a("#taskgantt").show();a("#taskslider").show();a("#tasktrash").show();a("#tasksliderlabel").show()});a("#taskradiotag").button().click(function(){a("#currvmap").remove();a("#taskgantt").hide();a("#taskslider").hide();a("#tasksliderlabel").hide();a("#tasktrash").hide();var i=a('<div id="currvmap"></div>').appendTo(e);i.vMap({type:5,pos:1,loff:b.loff,toff:b.toff+67,upobj:a.qsglobal.tasks,upblockclass:"tblock",uptextclass:"tblocktext",downobj:a.qsglobal.tags,downblockclass:"tblock",downtextclass:"tblocktext",})});a("#taskradioworker").button().click(function(){a("#currvmap").remove();a("#taskgantt").hide();a("#taskslider").hide();a("#tasksliderlabel").hide();a("#tasktrash").hide();var i=a('<div id="currvmap"></div>').appendTo(e);i.vMap({type:0,pos:2,loff:b.loff,toff:b.toff+67,upobj:a.qsglobal.tasks,upblockclass:"tblock",uptextclass:"tblocktext",downname:function(k){return k.firstname+" "+k.lastname},downdesc:function(k){return k.code},downobj:a.qsglobal.workers,downimg:true,downblockclass:"wblock",downtextclass:"wblocktext",})});a("#taskradioresource").button().click(function(){a("#currvmap").remove();a("#taskgantt").hide();a("#taskslider").hide();a("#tasksliderlabel").hide();a("#tasktrash").hide();var i=a('<div id="currvmap"></div>').appendTo(e);i.vMap({type:4,pos:1,loff:b.loff,toff:b.toff+67,upobj:a.qsglobal.tasks,upblockclass:"tblock",uptextclass:"tblocktext",downdesc:function(k){return k.desc+" ("+k.capacity+")"},downobj:a.qsglobal.resources,downblockclass:"tblock",downtextclass:"tblocktext",})});a('<label id="tasksliderlabel" for="taskslider">Zoom:</label>').css("margin-left",20).css("margin-top",8).css("float","left").appendTo(j);a('<div id="taskslider"></div>').css("margin-left",10).css("margin-top",10).css("width",100).css("float","left").slider({min:0.2,max:3,step:0.025,value:1.6,slide:function(i,k){a("#taskgantt").ganttScreen({data:f,mult:3.2-k.value,itemname:"task",currw:a(window).width()-b.loff,hoff:b.toff,moff:0,})}}).appendTo(j);a('<span><button id="taskfullscreen">Fullscreen</button></span>').css("float","right").appendTo(j).css("height","32").css("background","#a0b4d2").button({text:false,icons:{primary:"ui-icon-arrowthick-2-ne-sw"}}).click(function(){if(!a.qsglobal.isfullscreen){a.qsglobal.isfullscreen=true;a("#tasks").empty();a("#appmain").hide();a("#fullscreen").show();a("#fullscreen").width(a(window).width());a("#fullscreen").height(a(window).height());a("#fullscreen").tasksScreen({loff:0,toff:0})}else{a.qsglobal.isfullscreen=false;a("#fullscreen").empty();a("#fullscreen").hide();a("#appmain").show();a("#tasks").tasksScreen({loff:83,toff:101})}});a('<span id="tasktrash"><button>Delete</button></span>').css("float","right").appendTo(j).css("height","32").css("background","#a0b4d2").button({text:false,icons:{primary:"ui-icon-trash"}}).click(function(){rem=[];a(".ui-selected",".tasklist").each(function(){var k=a("#currtasklist li").index(this)-1;rem.push(k);var i=0;a.each(rem,function(m,n){if(n<k){i++}});k=k-i;var l={token:a.qsglobal.session_token,id:a(this).attr("objid")};postjson(a.qsglobal.dbaddr+"deltasks",l,function(m){if(m.success=="true"){a.qsglobal.tasks.splice(k,1)}else{alert("Delete failed.")}},false,null)});if(!a.qsglobal.isfullscreen){a("#tasks").tasksScreen({loff:83,toff:101})}else{a("#fullscreen").tasksScreen()}});var h=a('<div id="taskgantt"></div>').appendTo(a(this));h.addClass("ganttcontainer").css("width",a(window).width()-b.loff).css("height",a(window).height()-b.toff-1-65);h.ganttScreen({data:f,mult:1.6,itemname:"task",currw:a(window).width()-b.loff,hoff:b.toff,moff:0,onclick:function(i,k){a("#task-form").taskEditScreen({ind:k,item:a.qsglobal.tasks[k]}).dialog("open").dialog("option","title",i).dialog("open")}})})},taskEditScreen:function(c){a(this).empty();var d={ind:-1,item:null};var b=a.extend(d,c);return this.each(function(){var L=b;var f=a(this);var t="",j="",C="#cc3333",h="",w="",v="",O="",i="",k="",s="",l="";insunday="0";inmonday="0";intuesday="0";inwednesday="0";inthursday="0";infriday="0";insaturday="0";inactive="0";if(L.ind!=-1){t=(L.item.name==null)?"":L.item.name;j=(L.item.description==null)?"":L.item.description;C=(L.item.color==null)?"":L.item.color;h=(L.item.type==null)?"":L.item.type;w=(L.item.locationstart==null)?"":L.item.locationstart;v=(L.item.locationend==null)?"":L.item.locationend;O=(L.item.starttime==null)?"":L.item.starttime;i=(L.item.duration==null)?"":L.item.duration;k=(L.item.minworkduration==null)?"":L.item.minworkduration;s=(L.item.maxworkduration==null)?"":L.item.maxworkduration;l=(L.item.qty==null)?"":L.item.qty;insunday=(L.item.sunday==null)?"":L.item.sunday;inmonday=(L.item.monday==null)?"":L.item.monday;intuesday=(L.item.tuesday==null)?"":L.item.tuesday;inwednesday=(L.item.wednesday==null)?"":L.item.wednesday;inthursday=(L.item.thursday==null)?"":L.item.thursday;infriday=(L.item.friday==null)?"":L.item.friday;insaturday=(L.item.saturday==null)?"":L.item.saturday;inactive=(L.item.active==null)?"":L.item.active}a(this).css("padding",0).css("margin",0);var I=a('<div id="task-edit"><div>').appendTo(f);var z=a('<div id="we-top"></div>').css("width","100%").css("height","45px").css("padding",0).css("margin",0).css("float","left").appendTo(I);z.append(a('<p class="validateTips">Fill the required fields</p>').css("margin",10));var n=a('<div id="we-left"></div>').css("width","48%").css("height","100%").css("padding","0 10px 0 10px").css("margin",0).css("float","left").css("border","solid").css("border-color","#aaa").css("border-width","0px 0px 0px 0px").appendTo(I);var H=a('<div id="we-right"></div>').css("width","48%").css("float","left").css("height","100%").appendTo(I);n.append(a("<form></form>").html((L.ind!=-1&&L.item.active=="0"?'<div id="taskactivechoice"><input type="checkbox" id="taskactive" value="0" /><label for="taskactive">Active</label></div>':'<div id="taskactivechoice"><input type="checkbox" id="taskactive" value="1" checked="checked"/><label for="taskactive">Active</label></div>')+'<fieldset><label style="display: inline-block; width: 40%; height: 25px;" for="taskname">Task</label><input type="text" id="taskname" value="'+t+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%"/><br/><label style="display: inline-block; width: 40%; height: 25px;" for="taskdescription">Description</label><input type="text" id="taskdescription" value="'+j+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%"/><br/><label style="display: inline-block; width: 40%; height: 25px;" for="taskcolor">Color</label><input style="display: inline-block;" id="taskcolor" value="'+C+'"><br/><label style="display: inline-block; width: 40%; height: 25px;" for="tasktype">Type</label><input type="text" id="tasktype" value="'+h+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%"/><br/><label style="display: inline-block; width: 40%; height: 25px;" for="tasklocationstart">Location start</label><input type="button" id="tasklocationstart" value="'+w+'" class="button ui-widget-content ui-corner-all" style="display: inline-block; width:55%"/><br /><label style="display: inline-block; width: 40%; height: 25px;" for="tasklocationend">Location end</label><input type="button" id="tasklocationend" value="'+v+'" class="button ui-widget-content ui-corner-all" style="display: inline-block; width:55%;"/><br /></fieldset>'));H.append(a("<form></form>").html('<fieldset><label style="display: inline-block; width: 40%; height: 25px;" for="taskstarttime">Start time</label><input type="text" id="taskstarttime" value="'+O+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%;"/><br /><label style="display: inline-block; width: 40%; height: 25px;" for="taskduration">Duration</label><input type="text" id="taskduration" value="'+i+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%;"/><br /><label style="display: inline-block; width: 40%; height: 25px;" for="taskminworkduration">Minimum work duration</label><input type="text" id="taskminworkduration" value="'+k+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%;"/><br /><label style="display: inline-block; width: 40%; height: 25px;" for="taskmaxworkduration">Maximum work duration</label><input type="text" id="taskmaxworkduration" value="'+s+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%;"/><br /><label style="display: inline-block; width: 40%; height: 25px;" for="taskqty">Quantity</label><input type="text" id="taskqty" value="'+l+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%;"/><br /></fieldset><div style="display: inline-block; width: 40%; height: 25px;">Recurrence</div><div id="taskweekday" style="float: right;padding: 0 0 10px 0;">'+(L.ind!=-1&&L.item.sunday=="1"?'<input type="checkbox" style="display: inline-block;" id="tasksunday" value="1" checked="checked"/><label for="tasksunday">Su</label>':'<input type="checkbox" style="display: inline-block;" id="tasksunday" value="0"/><label for="tasksunday">Su</label>')+(L.ind!=-1&&L.item.monday=="1"?'<input type="checkbox" style="display: inline-block;" id="taskmonday" value="1" checked="checked"/><label for="taskmonday">Mo</label>':'<input type="checkbox" style="display: inline-block;" id="taskmonday" value="0"/><label for="taskmonday">Mo</label>')+(L.ind!=-1&&L.item.tuesday=="1"?'<input type="checkbox" style="display: inline-block;" id="tasktuesday" value="1" checked="checked"/><label for="tasktuesday">Tu</label>':'<input type="checkbox" style="display: inline-block;" id="tasktuesday" value="0"/><label for="tasktuesday">Tu</label>')+(L.ind!=-1&&L.item.wednesday=="1"?'<input type="checkbox" style="display: inline-block;" id="taskwednesday" value="1" checked="checked"/><label for="taskwednesday">We</label>':'<input type="checkbox" style="display: inline-block;" id="taskwednesday" value="0"/><label for="taskwednesday">We</label>')+(L.ind!=-1&&L.item.thursday=="1"?'<input type="checkbox" style="display: inline-block;" id="taskthursday" value="1" checked="checked"/><label for="taskthursday">Th</label>':'<input type="checkbox" style="display: inline-block;" id="taskthursday" value="0"/><label for="taskthursday">Th</label>')+(L.ind!=-1&&L.item.friday=="1"?'<input type="checkbox" style="display: inline-block;" id="taskfriday" value="1" checked="checked"/><label for="taskfriday">Fr</label>':'<input type="checkbox" style="display: inline-block;" id="taskfriday" value="0"/><label for="taskfriday">Fr</label>')+(L.ind!=-1&&L.item.saturday=="1"?'<input type="checkbox" style="display: inline-block;" id="tasksaturday" value="1" checked="checked"/><label for="tasksaturday">Sa</label>':'<input type="checkbox" style="display: inline-block;" id="tasksaturday" value="0"/><label for="tasksaturday">Sa</label>')+"</div>"));if(a("#tasklocationstart").val()==""){a("#tasklocationstart").button().click(function(){a.qsglobal.currcoord=a(this);setmap("0,0",a("#tasklocationstart"),true)})}else{a("#tasklocationstart").button().click(function(){a.qsglobal.currcoord=a(this);setmap(a("#tasklocationstart").val(),a("#tasklocationstart"),false)})}if(a("#tasklocationend").val()==""){a("#tasklocationend").button().click(function(){a.qsglobal.currcoord=a(this);setmap("0,0",a("#tasklocationend"),true)})}else{a("#tasklocationend").button().click(function(){a.qsglobal.currcoord=a(this);setmap(a("#tasklocationend").val(),a("#tasklocationend"),false)})}a("#taskactivechoice").buttonset();a("#taskweekday").buttonset();a("#taskcolor").simpleColor({border:"1px solid #333333",boxHeight:"25px",displayColorCode:true});a("#taskactive").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#tasksunday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#taskmonday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#tasktuesday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#taskwednesday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#taskthursday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#taskfriday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#tasksaturday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});var q=a("#taskname"),r=a("#taskdescription"),B=a("#taskcolor"),Q=a("#tasktype"),g=a("#tasklocationstart"),D=a("#tasklocationend"),p=a("#taskstarttime"),x=a("#taskduration"),F=a("#taskminworkduration"),N=a("#taskmaxworkduration"),K=a("#taskqty"),P=a("#tasksunday"),y=a("#taskmonday"),J=a("#tasktuesday"),E=a("#taskwednesday"),m=a("#taskthursday"),e=a("#taskfriday"),u=a("#tasksaturday"),M=a("#taskactive"),A=a([]).add(q).add(r).add(B).add(Q).add(g).add(D).add(p).add(x).add(F).add(N).add(K).add(P).add(y).add(J).add(E).add(m).add(e).add(u).add(M),G=a(".validateTips");f.dialog({autoOpen:false,width:950,modal:true,buttons:{Save:function(){var o=true;A.removeClass("ui-state-error");var R={token:a.qsglobal.session_token,name:q.val(),description:r.val(),color:B.val(),type:Q.val(),locationstart:g.val(),locationend:D.val(),starttime:p.val(),duration:x.val(),minworkduration:F.val(),maxworkduration:N.val(),qty:K.val(),sunday:P.val(),monday:y.val(),tuesday:J.val(),wednesday:E.val(),thursday:m.val(),friday:e.val(),saturday:u.val(),active:M.val(),id:-1};if(L.ind==-1){R.id=-1;postjson(a.qsglobal.dbaddr+"addtasks",R,function(S){if(S.success=="true"){R.id=S.id;a.qsglobal.tasks.push(R);if(!a.qsglobal.isfullscreen){a("#tasks").tasksScreen({loff:83,toff:101})}else{a("#fullscreen").tasksScreen()}}else{alert("Save failed.")}},false,null)}else{R.id=L.item.id;postjson(a.qsglobal.dbaddr+"updatetasks",R,function(S){if(S.success=="true"){R.id=L.item.id;a.qsglobal.tasks.splice(L.ind,1,R);if(!a.qsglobal.isfullscreen){a("#tasks").tasksScreen({loff:83,toff:101})}else{a("#fullscreen").tasksScreen()}}else{alert("Save failed.")}},false,null)}a(this).dialog("close")},Cancel:function(){a(this).dialog("close")}},close:function(){A.val("").removeClass("ui-state-error")}})})},taskresEditScreen:function(c){a(this).empty();var d={item:null,ind:-1,blockobj:null,};var b=a.extend(d,c);return this.each(function(){var f=b;var h=a(this);alert(f.ind+" "+f.item.qty);var e="",i="",m="";if(f.ind!=-1){e=f.item.qty;i=f.item.starttime;m=f.item.duration}var p=a('<div id="taskres-edit"><div>').appendTo(h);p.append(a('<p class="validateTips">Fill the required fields</p>'));p.append(a("<form></form>").html('<fieldset><label style="display: inline-block; width: 45%; height: 25px;" for="taskresqty">Resource qty requirement</label><input type="text" id="taskresqty" value="'+e+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:50%"/><br/><label style="display: inline-block; width: 45%; height: 25px;" for="taskresstarttime">Resource utilization start time</label><input type="text" id="taskresstarttime" value="'+i+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:50%"/><br/><label style="display: inline-block; width: 45%; height: 25px;" for="taskresduration">Resource utilization duration</label><input type="text" id="taskresduration" value="'+m+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:50%;"/><br /></fieldset>'));var n=a("#taskresqty"),l=a("#taskresstarttime"),g=a("#taskresduration"),k=a([]).add(n).add(l).add(g),j=a(".validateTips");h.dialog({autoOpen:false,width:750,modal:true,buttons:{Save:function(){var q=true;k.removeClass("ui-state-error");var o={token:a.qsglobal.session_token,qty:n.val(),starttime:l.val(),duration:g.val(),type:f.item.type,id1:f.item.id1,id2:f.item.id2};o.id=f.item.id;postjson(a.qsglobal.dbaddr+"updatemaps",o,function(r){if(r.success=="true"){o.id=f.item.id;a.qsglobal.maps.splice(f.ind,1,o)}else{alert("Save failed.")}},false,null);a(this).dialog("close")},Cancel:function(){a(this).dialog("close")}},close:function(){k.val("").removeClass("ui-state-error")}})})}})})(jQuery);function gettasksdata(a){$.qsglobal.tasks=null;var b={token:$.qsglobal.session_token};postjson($.qsglobal.dbaddr+"gettasks",b,function(c){if(c!=null){$.qsglobal.tasks=c.slice()}},true,a)};