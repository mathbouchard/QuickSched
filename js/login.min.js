(function(a){a.fn.extend({loginScreen:function(c){var d={title:"Login",background:"#eee"};var b=a.extend(d,c);return this.each(function(){var k=b;var i=a(this);var h=a('<div id="type-login"><div>').appendTo(a(this));h.append(a('<p class="validateTips">All form fields are required.</p>'));h.append(a("<form</form>").html('<fieldset><label for="lname">User name</label><input type="text" name="name" id="lname" class="text ui-widget-content ui-corner-all" /><label for="lpassword">Password</label><input type="password" name="password" id="lpassword" value="" class="text ui-widget-content ui-corner-all" /><a href="#" onclick="javascript:$(\'#register-form\').dialog( \'open\' );$(\'#login-form\').dialog(\'close\');">Not a member? Register</a></fieldset>'));var g=a("#lname"),f=a("#lpassword"),j=a([]).add(g).add(f),e=a(".validateTips");i.dialog({autoOpen:false,height:360,width:450,modal:true,buttons:{Login:function(){var l=true;j.removeClass("ui-state-error");var m={username:"",password:"",email:""};m.username=g.val();m.password=f.val();postjson(a.qsglobal.dbaddr+"login",m,function(n){if(n.success=="true"){a.cookie("quicksched-lt",n.token,{expires:1});a.cookie("quicksched-un",m.username,{expires:1});a.qsglobal.session_token=n.token;a.qsglobal.username=m.username;a("#usernametag").text(a.qsglobal.username);a("#loginzone").hide();a("#userzone").show();getalldata()}else{alert("Login failed.")}});a(this).dialog("close")},Cancel:function(){a(this).dialog("close")}},close:function(){j.val("").removeClass("ui-state-error")}})})},registerScreen:function(c){var d={title:"Login",background:"#eee"};var b=a.extend(d,c);return this.each(function(){var f=b;var g=a(this);var j=a('<div id="type-register"><div>').appendTo(a(this));j.append(a('<p class="validateTips">All form fields are required.</p>'));j.append(a("<form</form>").html('<fieldset><label for="rname">User name</label><input type="text" name="name" id="rname" class="text ui-widget-content ui-corner-all" /><label for="remail">Email</label><input type="text" name="email" id="remail" value="" class="text ui-widget-content ui-corner-all" /><label for="rpassword">Password</label><input type="password" name="password" id="rpassword" value="" class="text ui-widget-content ui-corner-all" /><label for="rcpassword">Confirm password</label><input type="password" name="cpassword" id="rcpassword" value="" class="text ui-widget-content ui-corner-all" /></fieldset>'));var e=a("#rname"),i=a("#remail"),m=a("#rpassword"),l=a("#rcpassword"),k=a([]).add(e).add(i).add(m).add(l),h=a(".validateTips");g.dialog({autoOpen:false,height:470,width:450,modal:true,buttons:{Register:function(){var n=true;k.removeClass("ui-state-error");n=n&&checkLength(e,"username",3,16);n=n&&checkLength(i,"email",6,80);n=n&&checkLength(m,"password",5,16);n=n&&checkRegexp(e,h,/^[a-z]([0-9a-z_])+$/i,"Username may consist of a-z, 0-9, underscores, begin with a letter.");n=n&&checkRegexp(i,h,/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,"eg. ui@jquery.com");n=n&&checkRegexp(m,h,/^([0-9a-zA-Z])+$/,"Password field only allow : a-z 0-9");n=n&&checkPassword(m,l);if(n){var o={username:"",password:"",email:""};o.username=e.val();o.password=m.val();o.email=i.val();postjson(a.qsglobal.dbaddr+"register",o,function(p){if(p.success=="true"){a.cookie("quicksched-lt",p.token,{expires:1});a.cookie("quicksched-un",o.username,{expires:1});a.qsglobal.session_token=p.token;a.qsglobal.username=o.username;a("#usernametag").text(a.qsglobal.username);a("#loginzone").hide();a("#userzone").show();getalldata()}else{alert("A problem occured during the registration process, please retry.")}})}if(n){a(this).dialog("close")}},Cancel:function(){a(this).dialog("close")}},close:function(){k.val("").removeClass("ui-state-error")}})})}})})(jQuery);function initLogin(){$.qsglobal.session_token=$.cookie("quicksched-lt");if($.qsglobal.session_token!=null){$.qsglobal.username=$.cookie("quicksched-un");$("#usernametag").text($.qsglobal.username);$("#loginzone").hide();$("#userzone").show();getalldata()}else{$.qsglobal.session_token="pcz6AJpxbT8gRB3B1P5WFw==";$.qsglobal.username="default";$("#usernametag").text($.qsglobal.username);$("#loginzone").hide();$("#userzone").show();getalldata()}}function logout(){$.cookie("quicksched-lt",null);$.cookie("quicksched-un",null);$("#usernametag").val("");$("#userzone").hide();$("#loginzone").show();resetalldata()}function updateTips(a,b){b.text(a).addClass("ui-state-highlight");setTimeout(function(){b.removeClass("ui-state-highlight",1500)},500)}function checkLength(c,d,b,a){if(c.val().length>a||c.val().length<b){c.addClass("ui-state-error");updateTips("Length of "+d+" must be between "+b+" and "+a+".");return false}else{return true}}function checkPassword(b,a){if(b.val()!=a.val()){updateTips("Password confirm do not match.");return false}else{return true}}function checkRegexp(b,d,a,c){if(!(a.test(b.val()))){b.addClass("ui-state-error");updateTips(c,d);return false}else{return true}};