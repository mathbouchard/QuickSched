(function(a){a.fn.extend({workersScreen:function(c){var d={loff:0,toff:0};var b=a.extend(d,c);return this.each(function(){a(this).empty();var f=a(this);var g=a('<div id="workerbar"></div>').appendTo(a(this));g.css("width",a(window).width()-b.loff-20);a('<span id="workerradioassign"></span>').html('<input type="radio" id="workerradioedit" checked="checked" name="workerradioassign"/><label for="workerradioedit">Edit</label><input type="radio" id="workerradiotag" name="workerradioassign"/><label for="workerradiotag">Tags</label><input type="radio" id="workerradiotask" name="workerradioassign"/><label for="workerradiotask">Tasks</label><input type="radio" id="workerradioshift" name="workerradioassign"/><label for="workerradioshift">Shifts</label><input type="radio" id="workerradioresource" name="workerradioassign"/><label for="workerradioresource">Resources</label>').css("float","left").buttonset().appendTo(g);a("#workerradioedit").button().click(function(){a("#currvmap").remove();a("#currworkerlist").show()});a("#workerradiotag").button().click(function(){a("#currvmap").remove();a("#currworkerlist").hide();var h=a('<div id="currvmap"></div>').appendTo(f);h.vMap({type:3,pos:1,loff:b.loff,toff:b.toff+67,upname:function(i){return i.firstname+" "+i.lastname},updesc:function(i){return i.code},upimg:true,upobj:a.qsglobal.workers,upblockclass:"wblock",uptextclass:"wblocktext",downobj:a.qsglobal.tags,downblockclass:"tblock",downtextclass:"tblocktext",})});a("#workerradiotask").button().click(function(){a("#currvmap").remove();a("#currworkerlist").hide();var h=a('<div id="currvmap"></div>').appendTo(f);h.vMap({type:0,pos:1,loff:b.loff,toff:b.toff+67,upname:function(i){return i.firstname+" "+i.lastname},updesc:function(i){return i.code},upimg:true,upobj:a.qsglobal.workers,upblockclass:"wblock",uptextclass:"wblocktext",downobj:a.qsglobal.tasks,downblockclass:"tblock",downtextclass:"tblocktext",})});a("#workerradioshift").button().click(function(){a("#currvmap").remove();a("#currworkerlist").hide();var h=a('<div id="currvmap"></div>').appendTo(f);h.vMap({type:1,pos:1,loff:b.loff,toff:b.toff+67,upname:function(i){return i.firstname+" "+i.lastname},updesc:function(i){return i.code},upimg:true,upobj:a.qsglobal.workers,upblockclass:"wblock",uptextclass:"wblocktext",downobj:a.qsglobal.shifts,downblockclass:"tblock",downtextclass:"tblocktext",})});a("#workerradioresource").button().click(function(){a("#currvmap").remove();a("#currworkerlist").hide();var h=a('<div id="currvmap"></div>').appendTo(f);h.vMap({type:2,pos:1,loff:b.loff,toff:b.toff+67,upname:function(i){return i.firstname+" "+i.lastname},updesc:function(i){return i.code},upimg:true,upobj:a.qsglobal.workers,upblockclass:"wblock",uptextclass:"wblocktext",downdesc:function(i){return i.description+" ("+i.capacity+")"},downobj:a.qsglobal.resources,downblockclass:"rblock",downtextclass:"rblocktext",})});a('<span><button id="workerfullscreen">Fullscreen</button></span>').css("float","right").appendTo(g).css("height","32").css("background","#a0b4d2").button({text:false,icons:{primary:"ui-icon-arrowthick-2-ne-sw"}}).click(function(){if(!a.qsglobal.isfullscreen){a.qsglobal.isfullscreen=true;a("#workers").empty();a("#appmain").hide();a("#fullscreen").show();a("#fullscreen").width(a(window).width());a("#fullscreen").height(a(window).height());a("#fullscreen").workersScreen({loff:0,toff:0})}else{a.qsglobal.isfullscreen=false;a("#fullscreen").empty();a("#fullscreen").hide();a("#appmain").show();a("#workers").workersScreen({loff:83,toff:101})}});a('<span><button id="workertrash">Delete</button></span>').css("float","right").appendTo(g).css("height","32").css("background","#a0b4d2").button({text:false,icons:{primary:"ui-icon-trash"}}).click(function(){rem=[];a(".ui-selected",".workerlist").each(function(){var j=a("#currworkerlist li").index(this)-1;rem.push(j);var i=0;a.each(rem,function(k,l){if(l<j){i++}});j=j-i;var h={token:a.qsglobal.session_token,id:a(this).attr("workerid")};postjson(a.qsglobal.dbaddr+"delworkers",h,function(k){if(k.success=="true"){a.qsglobal.workers.splice(j,1)}else{alert("Delete failed.")}},false,null)});if(!a.qsglobal.isfullscreen){a("#workers").workersScreen({loff:83,toff:101})}else{a("#fullscreen").workersScreen()}});var e=a('<ul class="workerlist" id="currworkerlist"></ul>').appendTo(a(this));if(a.qsglobal.workers!=null){temp=a("<li></li>").html('<img src="img/plus.png"></img><div class="wblocktext">Add a new worker</div>').addClass("wblock").click(function(){a("#worker-form").workerEditScreen().dialog("open")}).addClass("waddblock").attr("workerid",-1);e.append(temp);a.each(a.qsglobal.workers,function(h,i){var j="/img/someone.png";if(i.picturelink!=null&&i.picturelink!=""){j=i.picturelink}temp=a("<li></li>").html('<div class="tcolorblock" style="background:'+i.color+'"><img src="'+j+'"></img></div><div class="wblocktext"><h3>'+i.firstname+" "+i.lastname+"</h3>"+i.code+"</div>").addClass("wblock").attr("workerid",i.id).dblclick(function(){a("#worker-form").workerEditScreen({ind:h,item:i}).dialog("open").dialog("option","title",i.firstname+" "+i.lastname).dialog("open")});e.append(temp)})}e.selectable({filter:"li",cancel:".ui-selected, .waddblock"})})},workerEditScreen:function(c){a(this).empty();var d={ind:-1,item:null};var b=a.extend(d,c);return this.each(function(){var L=b;var f=a(this);var B="",p="",w="",m="",l="",j="",v="",A="#cc3333",I="",r="",k="";inmintimeoff="";inactive="true";if(L.ind!=-1){B=(L.item.firstname==null)?"":L.item.firstname;p=(L.item.lastname==null)?"":L.item.lastname;w=(L.item.email==null)?"":L.item.email;m=(L.item.phone1==null)?"":L.item.phone1;l=(L.item.phone2==null)?"":L.item.phone2;j=(L.item.code==null)?"":L.item.code;v=(L.item.picturelink==null)?"":L.item.picturelink;A=(L.item.color==null)?"":L.item.color;I=(L.item.minworkhour==null)?"":L.item.minworkhour;r=(L.item.maxworkhour==null)?"":L.item.maxworkhour;k=(L.item.targetworkhour==null)?"":L.item.targetworkhour;inmintimeoff=(L.item.mintimeoff==null)?"":L.item.mintimeoff}a(this).css("padding",0).css("margin",0);var J=a('<div id="worker-edit"><div>').appendTo(f);var x=a('<div id="we-top"></div>').css("width","100%").css("height","45px").css("padding",0).css("margin",0).css("float","left").appendTo(J);x.append(a('<p class="validateTips">Fill the required fields</p>').css("margin",10));var n=a('<div id="we-left"></div>').css("width","48%").css("height","100%").css("padding","0 10px 0 10px").css("margin",0).css("float","left").css("border","solid").css("border-color","#aaa").css("border-width","0px 0px 0px 0px").appendTo(J);var H=a('<div id="we-right"></div>').css("width","48%").css("float","left").css("height","100%").appendTo(J);var i=a('<div id="we-bottom"></div>').css("width","100%").css("padding",0).css("margin",0).css("float","left").css("border","solid").css("border-color","#aaa").css("border-width","0px 0px 0px 0px").appendTo(J);var M=a("<div></div>").addClass("leavediv").appendTo(i);var h=a('<div id="leavebar"></div>').appendTo(M).css("padding","5px 0px 0 0px");h.css("width","100%").css("height","32px");a("<div></div>").html("Leaves").css("padding","5px 0 0 10px").css("margin-right","20px").css("float","left").appendTo(h);a('<span><button id="leaveadd"></button></span>').css("float","left").appendTo(h).css("height","32").css("background","#a0b4d2").button({text:false,icons:{primary:"ui-icon-plusthick"}}).click(function(){a("#leave-form").leaveEditScreen({wind:L.ind,witem:L.item}).dialog("open")});var q=[];a('<span><button id="leavetrash"></button></span>').css("float","left").appendTo(h).css("height","32").css("background","#a0b4d2").button({text:false,icons:{primary:"ui-icon-trash"}}).click(function(){rem=[];a(".ui-selected",".leavelist").each(function(){var R=a("#currleavelist li").index(this);rem.push(R);var Q=0;a.each(rem,function(S,T){if(T<R){Q++}});R=R-Q;var o={token:a.qsglobal.session_token,id:a(this).attr("leaveid")};postjson(a.qsglobal.dbaddr+"delleaves",o,function(S){if(S.success=="true"){a.qsglobal.leaves.splice(q[R],1)}else{alert("Delete failed.")}},false,null)});f.workerEditScreen({ind:b.ind,item:b.item})});var s=a('<ul class="leavelist" id="currleavelist"></ul>').css("height","98%").css("overflow-y","scroll").appendTo(M);s.selectable({filter:"li",cancel:".ui-selected"});var K=0;if(a.qsglobal.leaves!=null){a.each(a.qsglobal.leaves,function(o,Q){if(Q.workerid==b.item.id){if(Q.onetime=="1"){temp=a("<li></li>").html('<div class="qstabletag">From</div><div class="qstableval">'+Q.startdate+" "+Q.starttime+'</div><div class="qstabletag">To</div><div class="qstableval">'+Q.enddate+" "+Q.endtime+"</div>").addClass("qstableline").attr("leaveid",Q.id).dblclick(function(){a("#leave-form").leaveEditScreen({ind:o,item:Q,wind:L.ind,witem:L.item}).dialog("open")})}else{temp=a("<li></li>").html('<div class="qstabletag">From</div><div class="qstableval">'+Q.starttime+'</div><div class="qstabletag">To</div><div class="qstableval">'+Q.endtime+'</div><div class="qstabletag">Recurrence</div>'+((Q.sunday=="1")?'<div class="qstableval">Su</div>':"")+((Q.monday=="1")?'<div class="qstableval">Mo</div>':"")+((Q.tuesday=="1")?'<div class="qstableval">Tu</div>':"")+((Q.wednesday=="1")?'<div class="qstableval">We</div>':"")+((Q.thursday=="1")?'<div class="qstableval">Th</div>':"")+((Q.friday=="1")?'<div class="qstableval">Fr</div>':"")+((Q.saturday=="1")?'<div class="qstableval">Sa</div>':"")).addClass("qstableline").attr("leaveid",Q.id).dblclick(function(){a("#leave-form").leaveEditScreen({ind:o,item:Q,wind:L.ind,witem:L.item}).dialog("open")})}s.append(temp);q.push(K)}K++})}n.append(a("<form></form>").html('<fieldset><label style="display: inline-block; width: 40%; height: 25px;" for="workerpicturelink">Picture</label><input type="text" id="workerpicturelink" value="'+v+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%"/><br/><label style="display: inline-block; width: 40%; height: 25px;" for="workercolor">Color</label><input style="display: inline-block;" id="workercolor" value="'+A+'"><br/><label style="display: inline-block; width: 40%; height: 25px;" for="workerfirstname">First name</label><input type="text" id="workerfirstname" value="'+B+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%"/><br/><label style="display: inline-block; width: 40%; height: 25px;" for="workerlastname">Last name</label><input type="text" id="workerlastname" value="'+p+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%;"/><br /><label style="display: inline-block; width: 40%; height: 25px;" for="workeremail">Email</label><input type="text" id="workeremail" value="'+w+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%;"/><br /><label style="display: inline-block; width: 40%; height: 25px;" for="workercode">Code</label><input type="text" id="workercode" value="'+j+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%;"/><br /></fieldset>'));H.append(a("<form></form>").html('<fieldset><label style="display: inline-block; width: 40%; height: 25px;" for="workerphone1">Phone #1</label><input type="text" id="workerphone1" value="'+m+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%;"/><br /><label style="display: inline-block; width: 40%; height: 25px;" for="workerphone2">Phone #2</label><input type="text" id="workerphone2" value="'+l+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%;"/><br /><label style="display: inline-block; width: 40%; height: 25px;" for="workerminworkhour">Minimum work hour</label><input type="text" id="workerminworkhour" value="'+I+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%;"/><br /><label style="display: inline-block; width: 40%; height: 25px;" for="workermaxworkhour">Maximum work hour</label><input type="text" id="workermaxworkhour" value="'+r+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%;"/><br /><label style="display: inline-block; width: 40%; height: 25px;" for="workertargetworkhour">Target work hour</label><input type="text" id="workertargetworkhour" value="'+k+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%;"/><br /><label style="display: inline-block; width: 40%; height: 25px;" for="workermintimeoff">Minimum time between shifts</label><input type="text" id="workermintimeoff" value="'+inmintimeoff+'" class="text ui-widget-content ui-corner-all" style="display: inline-block; width:55%;"/><br /></fieldset>'));a("#workercolor").simpleColor({border:"1px solid #333333",boxHeight:"25px",displayColorCode:true});var O=a("#workerfirstname"),C=a("#workerlastname"),u=a("#workeremail"),F=a("#workerphone1"),E=a("#workerphone2"),g=a("#workercode"),D=a("#workerpicturelink"),z=a("#workercolor"),N=a("#workerminworkhour"),t=a("#workermaxworkhour"),e=a("#workertargetworkhour"),P=a("#workermintimeoff"),y=a([]).add(O).add(C).add(u).add(F).add(E).add(g).add(D).add(z).add(N).add(t).add(e).add(P),G=a(".validateTips");f.dialog({autoOpen:false,width:950,modal:true,buttons:{Save:function(){var Q=true;y.removeClass("ui-state-error");var o={token:a.qsglobal.session_token,firstname:O.val(),lastname:C.val(),email:u.val(),phone1:F.val(),phone2:E.val(),code:g.val(),picturelink:D.val(),color:z.val(),minworkhour:N.val(),maxworkhour:t.val(),targetworkhour:e.val(),mintimeoff:P.val(),id:-1};if(L.ind==-1){o.id=-1;postjson(a.qsglobal.dbaddr+"addworkers",o,function(R){if(R.success=="true"){o.id=R.id;a.qsglobal.workers.push(o);if(!a.qsglobal.isfullscreen){a("#workers").workersScreen({loff:83,toff:101})}else{a("#fullscreen").workersScreen()}}else{alert("Save failed.")}},false,null)}else{o.id=L.item.id;postjson(a.qsglobal.dbaddr+"updateworkers",o,function(R){if(R.success=="true"){o.id=L.item.id;a.qsglobal.workers.splice(L.ind,1,o);if(!a.qsglobal.isfullscreen){a("#workers").workersScreen({loff:83,toff:101})}else{a("#fullscreen").workersScreen()}}else{alert("Save failed.")}},false,null)}a(this).dialog("close")},Cancel:function(){a(this).dialog("close")}},close:function(){y.val("").removeClass("ui-state-error")}})})},leaveEditScreen:function(c){a(this).empty();var d={ind:-1,wind:-1,item:null,witem:null};var b=a.extend(d,c);return this.each(function(){var g=b;var i=a(this);var m="",l="",s="",t="",h="0",f="0",p="0",k="0",v="0",e="0",n="0";insaturday="0";if(g.ind!=-1){m=g.item.startdate;l=g.item.starttime;s=g.item.enddate;t=g.item.endtime;h=g.item.onetime;f=g.item.sunday;p=g.item.monday;k=g.item.tuesday;v=g.item.wednesday;e=g.item.thursday;n=g.item.friday;insaturday=g.item.saturday}var u=a('<div id="leave-edit"><div>').appendTo(i);u.append(a('<p class="validateTips">Fill the required fields</p>'));u.append(a("<form></form>").html('<div id="leavetypechoice">'+(g.ind!=-1&&g.item.onetime=="0"?'<input type="radio" id="onetimechoice" name="radio" /><label for="onetimechoice">One time</label>':'<input type="radio" id="onetimechoice" name="radio" checked="checked" /><label for="onetimechoice">One time</label>')+(g.ind!=-1&&g.item.onetime=="0"?'<input type="radio" id="recurrentchoice" name="radio" checked="checked" /><label for="recurrentchoice">Recurrent</label>':'<input type="radio" id="recurrentchoice" name="radio" /><label for="recurrentchoice">Recurrent</label>')+'</div><div id="leaveonetime"><label style="display: inline-block; width: 30%; height: 25px;" for="leavestartdate">Start date</label><input style="display: inline-block;" id="leavestartdate" value="'+m+'"><br/><label style="display: inline-block; width: 30%; height: 25px;" for="leavestarttime">Start time</label><input style="display: inline-block;" id="leavestarttime" value=""><br/><label style="display: inline-block; width: 30%; height: 25px;" for="leaveenddate">End date</label><input style="display: inline-block;" id="leaveenddate" value="'+s+'"><br/><label style="display: inline-block; width: 30%; height: 25px;" for="leaveendtime">End time</label><input style="display: inline-block;" id="leaveendtime" value=""><br/></div><div id="leavereccurent"><label style="display: inline-block; width: 30%; height: 25px;" for="rleavestarttime">Start time</label><input style="display: inline-block;" id="rleavestarttime" value=""><br/><label style="display: inline-block; width: 30%; height: 25px;" for="rleaveendtime">End time</label><input style="display: inline-block;" id="rleaveendtime" value=""><br/><div id="leaveweekday">'+(g.ind!=-1&&g.item.sunday=="1"?'<input type="checkbox" id="leavesunday" value="1" checked="checked"/><label for="leavesunday">Su</label>':'<input type="checkbox" id="leavesunday" value="0"/><label for="leavesunday">Su</label>')+(g.ind!=-1&&g.item.monday=="1"?'<input type="checkbox" id="leavemonday" value="1" checked="checked"/><label for="leavemonday">Mo</label>':'<input type="checkbox" id="leavemonday" value="0"/><label for="leavemonday">Mo</label>')+(g.ind!=-1&&g.item.tuesday=="1"?'<input type="checkbox" id="leavetuesday" value="1" checked="checked"/><label for="leavetuesday">Tu</label>':'<input type="checkbox" id="leavetuesday" value="0"/><label for="leavetuesday">Tu</label>')+(g.ind!=-1&&g.item.wednesday=="1"?'<input type="checkbox" id="leavewednesday" value="1" checked="checked"/><label for="leavewednesday">We</label>':'<input type="checkbox" id="leavewednesday" value="0"/><label for="leavewednesday">We</label>')+(g.ind!=-1&&g.item.thursday=="1"?'<input type="checkbox" id="leavethursday" value="1" checked="checked"/><label for="leavethursday">Th</label>':'<input type="checkbox" id="leavethursday" value="0"/><label for="leavethursday">Th</label>')+(g.ind!=-1&&g.item.friday=="1"?'<input type="checkbox" id="leavefriday" value="1" checked="checked"/><label for="leavefriday">Fr</label>':'<input type="checkbox" id="leavefriday" value="0"/><label for="leavefriday">Fr</label>')+(g.ind!=-1&&g.item.saturday=="1"?'<input type="checkbox" id="leavesaturday" value="1" checked="checked"/><label for="leavesaturday">Sa</label>':'<input type="checkbox" id="leavesaturday" value="0"/><label for="leavesaturday">Sa</label>')+"</div></div>"));a("#leavetypechoice").buttonset();a("#leaveweekday").buttonset();var j="1";if(g.ind!=-1&&g.item.onetime=="0"){a("#leaveonetime").hide();a("#leavereccurent").show();a("#rleavestarttime").val(l);a("#rleaveendtime").val(t);j="0"}else{a("#leaveonetime").show();a("#leavereccurent").hide();a("#leavestarttime").val(l);a("#leaveendtime").val(t);j="1"}a("#leavesunday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#leavemonday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#leavetuesday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#leavewednesday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#leavethursday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#leavefriday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#leavesaturday").button().click(function(){a(this).val(a(this).val()=="0"?"1":"0")});a("#onetimechoice").button().click(function(){a("#leaveonetime").show();a("#leavereccurent").hide();a("#rleavestarttime").val("");a("#rleaveendtime").val("");j="1"});a("#recurrentchoice").button().click(function(){a("#leaveonetime").hide();a("#leavereccurent").show();a("#leavestarttime").val("");a("#leaveendtime").val("");j="0"});var r=a("#leavestartdate"),q=a("#leavestarttime");rstarttime=a("#rleavestarttime"),enddate=a("#leaveenddate"),endtime=a("#leaveendtime"),rendtime=a("#rleaveendtime"),sunday=a("#leavesunday"),monday=a("#leavemonday"),tuesday=a("#leavetuesday"),wednesday=a("#leavewednesday"),thursday=a("#leavethursday"),friday=a("#leavefriday"),saturday=a("#leavesaturday"),allFields=a([]).add(r).add(q).add(rstarttime).add(enddate).add(endtime).add(rendtime).add(sunday).add(monday).add(tuesday).add(wednesday).add(thursday).add(friday).add(saturday),tips=a(".validateTips");i.dialog({autoOpen:false,width:750,modal:true,buttons:{Save:function(){var w=true;allFields.removeClass("ui-state-error");var o={token:a.qsglobal.session_token,startdate:r.val(),starttime:q.val()+rstarttime.val(),enddate:enddate.val(),endtime:endtime.val()+rendtime.val(),onetime:j,sunday:sunday.val(),monday:monday.val(),tuesday:tuesday.val(),wednesday:wednesday.val(),thursday:thursday.val(),friday:friday.val(),saturday:saturday.val(),workerid:g.witem.id,id:""};if(g.ind==-1){o.id=-1;postjson(a.qsglobal.dbaddr+"addleaves",o,function(x){if(x.success=="true"){o.id=x.id;a.qsglobal.leaves.push(o);a("#worker-form").workerEditScreen({ind:g.wind,item:g.witem})}else{alert("Save failed.")}},false,null)}else{o.id=g.item.id;postjson(a.qsglobal.dbaddr+"updateleaves",o,function(x){if(x.success=="true"){a.qsglobal.leaves.splice(g.ind,1,o);a("#worker-form").workerEditScreen({ind:g.wind,item:g.witem})}else{alert("Save failed.")}},false,null)}a(this).dialog("close")},Cancel:function(){a(this).dialog("close")}},close:function(){allFields.val("").removeClass("ui-state-error")}})})}})})(jQuery);function getworkersdata(b){$.qsglobal.workers=null;var c={token:$.qsglobal.session_token};postjson($.qsglobal.dbaddr+"getworkers",c,function(d){if(d!=null){$.qsglobal.workers=d.slice()}},true,b);$.qsglobal.workers=null;var a={token:$.qsglobal.session_token};postjson($.qsglobal.dbaddr+"getleaves",a,function(d){if(d!=null){$.qsglobal.leaves=d.slice()}},true,b)};